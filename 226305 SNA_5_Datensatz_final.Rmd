---
title: "226305 SNA_5 Datensatz Blcokwoche WS 20/21"
subtitle: "Netzwerk Spielerberatungsfirma Bahia Internacional"
author: "Antonio Jung, aj037@hdm-stuttgart.de"
date: '`r format(Sys.Date(), "%d. %B %Y")`'
output: html_notebook
---




## Links zu unserem Projekt  
- [Github](https://github.com/226305-Spielerberater/SNA_5)  
- [Codebuch](https://github.com/226305-Spielerberater/SNA_5/blob/master/Codebuch-Datensatz-final.md)
- [edgelist](https://docs.google.com/spreadsheets/d/1HAMpYalGkv4Yx47ARHKfwqx2Qy7a3AXoDmHiXOxnVcQ/edit?usp=sharing)  
- [nodelist](https://docs.google.com/spreadsheets/d/1wMrEgAx4l-DVxKTGNLc3EQs-s4d43OH6TuXFkdkPIx4/edit?usp=sharing)
- [Arbeitsplan](https://docs.google.com/document/d/1kXHPGhDJBHiq-KGn6manhoT_SguMqLS8PvVGjTwHRsw/edit?usp=sharing)
- [Quellen](https://docs.google.com/document/d/1B4aoOhn2EsVD1gP794orowvsMzsrLk-ZSAdynTtYNKo/edit?usp=sharing)


## Netzwerk erstellen
Erstellen Sie ihr Netzwerk aus ihrer Edge- und Nodelist auf github. Bitte annotieren/kommentieren Sie die wichtigsten Schritte im Code mit # (das gilt für alle Chunks)

```{r Netzwerk einlesen, echo=FALSE, fig.height=19, fig.width=9, message=FALSE, warning=TRUE, paged.print=FALSE}

library(igraph)
# Erstellt das Netzwerk aus ihren Edge- und Nodelists. Nicht vergessen, dass der Pfad auf Github nur funktioniert, wenn die Rohdaten (raw) eingelesen werden.


# Einlesen der Edge- und Nodelist
el <- read.csv("https://raw.githubusercontent.com/226305-Spielerberater/SNA_5/master/Edges.csv", header=T, as.is=T, sep = ",")
nodes <- read.csv("https://raw.githubusercontent.com/226305-Spielerberater/SNA_5/master/Nodes.csv", header=T, as.is=T, sep = ",")

# Matrix erstellen
edgematrix <-as.matrix(el)

# Zusammenführen von Edge- und Nodelist als igraph-Objekt
# 
s <- graph_from_data_frame(d=edgematrix, vertices=nodes, directed=T)

# wenn hier eine Fehlermeldung erscheint, passen wahrscheinlich die IDs von Edge- und Nodelist nicht zusammenpassen. 
# 
# 
E(s)$arrow.size <- .3

?igraph.plotting

# weist den Attributswerten entsprechende Formen zu
vertex.attributes(s)$type
V(s)[V(s)$type == 0]$shape <- "square"  
V(s)[V(s)$type == 1]$shape <- "circle"
V(s)[V(s)$type == 0]$color <- "grey70"
V(s)[V(s)$type == 1]$color <- "red"




plot(s)

plot(s,
     asp=0, 
     layout=layout_with_kk,
     vertex.size=5,
     edge.arrow.size=.3,
     edge.color="yellow",
     edge.curved=curve_multiple(s)
)

par(mar=c(0,0,0,0))     


#par(mar=c(0,0.5,0.5,0)) 
s


```






```{r Visualisierung Hauptnetzwerk, fig.height=20, fig.width=35}

V(s)[V(s)$type == 0]$shape <- "square"  
V(s)[V(s)$type == 1]$shape <- "circle"
V(s)[V(s)$type == 0]$color <- "grey40"
V(s)[V(s)$type == 1]$color <- "red"


plot(s,
     asp=0, 
     layout=layout_nicely,
     vertex.size=degree(s)/7,
     vertex.label.degree=0,
     edge.arrow.size=.3,
     edge.color="grey",
     edge.curved=curve_multiple(s)
)

s



```


```{r Visualisierung vereinfachtes Hauptnetzwerk nur mit Knoten deren degree > 1 ist}





```



## Teilnetzwerke
Teilnetzwerke nach Node- und Edge-Attributen.

```{r Teilnetzwerke nach Edge-Attributeb, fig.height=16, fig.width=10}

#Teilnetzwerke nach Edge-Attributen

#erstelle Teilnetzwerk nach Geschäftsbeziehung (Spielerberater zu Profifußballer)
business <- subgraph.edges(s, E(s)[relation==1])

plot(business,
     asp=0,
     vertex.size=3,
     main="Geschäftsbeziehung")

#erstelle Teilnetzwerk nach Liga-Beziehung

liga <- subgraph.edges(s, E(s)[relation==2])

plot(liga,
     asp=0,
     vertex.size=3,
     main="Liga-Beziehung")

#erstelle Teilnetzwerk nach Vereinsbeziehung

club <- subgraph.edges(s, E(s)[relation==3])

plot(club,
     asp=0,
     vertex.size=3,
     main="Vereinsbeziehung")

#erstelle Teilnetzwerk mit Nationalspielern

nationalspieler <- subgraph.edges(s, E(s)[relation==4]) 

plot(nationalspieler,
     asp=0,
     vertex.size=3,
     main="Nationalspieler")

#erstelle Teilnetzwerk nach Mitspieler-Beziehung (in Nationallmannschaft und Verein)

teamplayer <- subgraph.edges(s, E(s)[relation>4]) 

plot(teamplayer,
     asp=0,
     vertex.size=3,
     main="Teamkollegen")



```

## Teilnetzwerke nach Node-Attributen

```{r Teilnetzwerke nach Node-Attributen}


## Teilnetzwerke nach Node-Attributen

#erstelle Netzwerk mit allen Spieler spanischer Nationalität

spain <- delete_vertices(s, V(s)[nation!=1])

plot(spain,
     main="spanische Spieler")

#wie viele spanische Spieler sind in der spanischen Agentur Bahia Internacional vertreten? => Homophilie?

#erstelle Netzwerk mit allen spanischen Spielern, die von Bahia Inernacional beraten werden

spain_BI <- delete_vertices(s, V(s)[agency!=5])

plot(spain_BI,
     main="spanische Spieler BI")


spain
spain_BI

#20 der 22 spanischen Spieler werden von der Agentur Bahia Internacional beraten



#das Alter der Spieler

very_young <- delete.vertices(s, V(s)[age!=1])

plot(very_young,
     main="18-21-Jährige")




```


## Teilnetzwerke Spielerberater
```{r Teilnetzwerke Spielerberater, fig.height=12, fig.width=20}

#Netzwerk aller Spieler, die von Mendes beraten werden
Mendes <- delete.vertices(s, V(s)[agency!=1])
Mendes

plot(Mendes,
     asp=0,
     vertex.size=5,
     layout=layout_nicely,
     main="Klienten von Mendes")

#Portugal-Connection wird deutlich!!

#Netzwerk aller Spieler, die von Jonathan Barnett beraten werden
Barnett <- delete.vertices(s, V(s)[agency!=2])
Barnett

plot(Barnett,
     asp=0,
     layout=layout_with_fr,
     vertex.size=5,
     edge.arrow.size=.4,
     main="Klienten von Barnett")

#England-Connection!!

#Netzwerk aller Spieler, die von Mino Raiola beraten werden
Raiola <- delete.vertices(s, V(s)[agency!=3])
Raiola

plot(Raiola,
     asp=0,
     main="Klienten von Raiola")

#Italien und Holland-Connection => Raiola = Holländer
#woher kommen die ganzen Italiener?

#Netzwerk aller Spieler, die von Sports Total/Volker Struth beraten werden
Sports_Total <- delete.vertices(s, V(s)[agency!=4])
Sports_Total

plot(Sports_Total,
     asp=0,
     main="Klienten von Sports Total")
#deutsche Agentur => Deutschland Connection!

#Netzwerk aller Spieler, die von Bahia Internacional/Jose Otin beraten werden
Bahia_Internacional <- delete.vertices(s, V(s)[agency!=5])
Bahia_Internacional

plot(Bahia_Internacional,
     asp=0,
     main="Klienten von Bahia Internacional")

#Netzwerk aller Spieler, die von Meissa N'diaye beraten werden
Ndiaye <- delete.vertices(s, V(s)[agency!=6])
Ndiaye

plot(Ndiaye,
     asp=0,
     main="Klienten von Meissa N'diaye")

#Netzwerk aller Spieler, die von Kroth/pro Profil beraten werden
Pro_Profil <- delete.vertices(s, V(s)[agency!=7])
Pro_Profil

plot(Pro_Profil,
     asp=0,
     main="Klienten von Pro Profil")


#Netzwerk aller Spieler, die von fernando Felicevich beraten werden
Felicevich <- delete.vertices(s, V(s)[agency!=8])
Felicevich

plot(Felicevich,
     asp=0,
     main="Klienten von Fernando Felicevich")

#Chile-Connection => Felicevich ist Chilene

```

##Ego-Netzwerke
```{r Ego-Netzwerk Bundesliga erster Ordnung, fig.height=10, fig.width=16}




#warum Egonetzwerk von Bundesliga interessant? => wie viele Verbindungen gehen die einzelnen Knoten ein?

#berechne degree von s
s_degree <- degree(s)
s_degree


#welcher Knoten hat die meisten Verbindungen?
which.max(s_degree)

#Bundesliga hat mit 67 die meisten Degrees => deshalb interessant


buli <- make_ego_graph(s, order = 1, nodes = V(s)$name == "Bundesliga", mode ="all")
buli
buli1 <- buli[[1]]
buli1


plot(buli1,
     asp=0,
     layout=layout_nicely,
     vertex.size=6,
     vertex.label.dist=1,
     edge.arrow.size=.5,
     edge.color="grey",
     edge.curved=curve_multiple(buli1),
     main="Ego-Netzwerk Bundesliga erster Ordnung")


```






## Netzwerkmaße

```{r Netzwerkmaße}


edge_density(s)

#1 Prozent aller möglichen Beziehungen realisiert?!

```

## Zentralitätsmaße

```{r Zentralitätsmaße}

#degree-Werte

s_degree <- degree(s)

s_degree

which.max(s_degree)

#Bundesliga mit meisten Degrees (67)


#betweenness-Werte

s_between <- betweenness(s)
s_between
which.max(s_between)
#Cancelo = wichtige Brücke/Verbindung zu anderen Spielern

```



```

## Cluster & Communities
Erstellen Sie ein Cluster des Gesamtnetzwerks. Welche Clustermethode Sie wählen ist egal. Wie lässt sich das Cluster interpretieren?
```{r Cluster}

cl <- cluster_walktrap(s)

cl1 <- cl[[1]]

?cluster_walktrap

plot(cl,
     s,
     main="Cluster Walktrap")

#hier vor allem Clusterbildung durch Ligazugehörigkeit, hier wird deutlich, dass BI vor allem Spieler aus der spanischen BBVA Liga berät
```
```{r Components}

is.connected(s)

components(s)

#Netzwerk bist hat nur eine Komponente, es sind alle miteinander verbunden!

```


```


```


**Zeitaufwand (geschätzt)**  
 
- Datenerhebung (Codebuch, Edge- und Nodelist): ca. 30h  
-


